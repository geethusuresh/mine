{% load humanize %}
{% load zone %}

<!DOCTYPE html>
<html>
  <head>
    <title>Person Group</title>
        <link rel="stylesheet" href="/static/css/bootstrap.css">
    <link rel="stylesheet" href="/static/css/docs.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <style type="text/css">
      .borderless tbody tr td, .borderless thead tr th {
      border: none;
      }
      table.fixed { table-layout:fixed; word-break:break-all;}
      table.fixed td { overflow: hidden; }
      .centered {width:300px;display:table-cell;vertical-align:middle; }
    </style>
    <link href="/static/css/font-awesome.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap.js"></script>
    <script src="/static/js/jquery-2.1.0.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/king-common.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/asset/bootstrap-select.min.css">
  </head>
  <body>
<div class="top-bar">

  <div class="container">
    <div class="row">
    <!-- logo -->
    <div class="col-md-2 logo">
      <h1 class="sr-only">Admin Dashboard</h1>
    </div>
    <!-- end logo -->
    <div class="col-md-10">
      <div class="row">
        <div class="col-md-3">
         </div>
        <div class="col-md-9">
          <div class="top-bar-right">
            <a href="#" class="hidden-md hidden-lg main-nav-toggle"><i class="fa fa-bars"></i></a>
            <button type="button" id="start-tour" class="btn btn-link"><i class="glyphicon glyphicon-user"></i>{{user.user}}</button>
          </div>
        </div>
      </div>
     </div>
    </div><!-- /row -->
  </div><!-- /container -->
</div>
<div class="container"  >
    <div class="row">
      <div class="col-md-2 left-sidebar">

            <!-- main-nav -->
            <nav class="main-nav">
              
              <ul class="main-menu">
              <img src="/static/img/logo.png">
                 {% include "side_bar/sidebar.html" %} 
                <!-- <li  ><a href="/" class="js-sub-menu-toggle"><i class="glyphicon glyphicon-list-alt"></i><span class="text">List</span>
                  <i class="toggle-icon fa fa-angle-left"></i></a>
                  <ul class="sub-menu  ">
                    <li  ><a href="/persongroupadmin/list/workgroup"><span class="text">Workgroup</span></a></li>
                    <li><a href="/persongroupadmin/list/subgroup"><span class="text">Subgroup</span></a></li>
                    <li  ><a href="/list/role"><span class="text">Role</span></a></li>
                    <li  ><a href="/list/privilege"><span class="text">Privilege</span></a></li>
                  </ul>
                </li> -->
              </ul>
            </nav><!-- /main-nav -->
            <div class="sidebar-minified js-toggle-minified">
              <i class="fa fa-angle-left"></i>
            </div>
            <div class="sidebar-content">
              <div class="panel panel-default">
                <div class="panel-heading"><h5><i class="fa fa-lightbulb-o"></i> Tips</h5></div>
                <div class="panel-body">
                  <p>You can do live search to the widget at search box located at top bar. It's very useful if your dashboard is full of widget.</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-10 content-wrapper">
            
            
            <!-- main -->
            <div class="content">

              <div class="main-header">
                <h2>Subgroups</h2>
                
              </div>
{% if messages %}
                <ul>
                {% for message in messages %}
                {% if message.tags == 'success' %}
                  <div class="alert alert-success" >{{ message|safe }}</div>
                  {% else %}
                    <div class="alert alert-danger" >{{ message|safe }}</div>
                  {% endif %}
                  {% endfor %}
                </ul>
              {% endif %}
              <div class="main-content">
                <div class="row">
                  <div class="col-sm-10">
                    <div class="widget">
                  <div class="widget-header"><h3><i class="fa fa-magic"></i>Subgroups</h3>
                    <!-- <a href="" data-toggle="modal" data-target="#member" class="btn btn-success btn-xs"  style=" float:right;margin-right:10px;margin-top:5px">Add New </a>
                    <a href="" data-toggle="modal" data-target="#register" class="btn btn-success btn-xs"  style=" float:right;margin-right:5px;margin-top:5px">Register New </a> -->
                  </div>
                  <div class="widget-content">
                          <div class="wizard-wrapper">
                            <div id="" class="wizard">
                            <form id="myform3" name ="myform3" method='post' action=''>
                              <fieldset>
                           <div class="controls" style="text-align: center;">
                            <select class="form-control" id="customer3" name="customer3" required style="width:300px;display: block;margin: 0 auto;">
                              <option value="">Select Customer</option>
                              {% for customer in customers %}
                                <option value="{{ customer.id }}">{{ customer.customername }}</option>
                              {% endfor %}
                            </select></p>
                            <select class="form-control"  id="workgroup3" name="workgroup3" required style="width:300px;display: block;margin: 0 auto;">
                              <option value="">Select Workgroup</option>
                            </select></p>
                            <div id="subgroupadd__div3" style="display:none">
                              <table class="table borderless" id="subgroup_table3">
                                <thead>
                                <tr>
                                  <th>Select</th>
                                  <th>Subgroup</th>
                                  <th>Description</th>
                                </tr>  
                                </thead>   
                              </table>
                            </div>
                            </p>
                           </form>
                           <button class="btn btn-success" type="button" id="rw3">Remove Subgroup</button>  
                          </div>
                        </fieldset>
                              </form>
                              
                            </div>
                          </div>
                      </div>
 
                    </div>


                    <div class="widget">
                      <div class="widget-header"><h3><i class="fa fa-magic"></i>Active Subgroups</h3>
                    
                      </div>
                      <div class="widget-content">
                          <table class="table borderless fixed" id="example">
                              <thead>
                                  <tr>
                                    <th>Select</th>
                                    <th>Subgroup</th>
                                    <th>Description</th>
                                    <th>Workgroup</th>
                                  </tr>     
                                </thead>
                              <tbody>
                              {% for subgroup in subgroup_list %}
                              <tr>
                                <td>{{ forloop.counter}}</td>
                                <td>{{ subgroup.subgroupname }}</td>
                                <td>{{ subgroup.description}}</td>
                                <td>{{ subgroup.workgroup }}</td>
                                <!-- <td><a href="/personadmin/update/{{person.id}}"><input type="button" value="update" class="btn btn-success btn-sm" ></a></td> -->
                                <!-- <td><a href="/personadmin/deactivate/{{person.id}}" ><input type="button" value="delete" class="btn btn-success btn-sm"></a></td> -->
                              </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                      </div>
 
                    </div>
                  </div>
                  <div class="col-sm-2">
                    <div class="widget">
                      <div class="widget-header"><h3></h3>
                          
                      </div>
                      <div class="widget-content">
                          <!-- <a href="" data-toggle="modal" data-target="#member" class="btn btn-link btn-block"  >Add New Person</a><p><p>
                          <a href="" data-toggle="modal" data-target="#register" class="btn btn-link btn-block"  >Register New Person</a> -->
                          <ul class="main-menu">
                              <li><a href="/persongroupadmin/add/subgroup"></i><span class="text">Add New Subgroup</span></a></li><p>
                              <li  ><a href="/persongroupadmin/remove/subgroup" ></i><span class="text ">Remove Subgroup</span></a>
                              </li><p>
                              <li  ><a href="/persongroupadmin/home" ></i><span class="text ">Subgroup Mapping</span></a>
                              </li><p>
                              <li  ><a href="/persongroupadmin/remove" ></i><span class="text ">Subgroup Members</span></a>
                              </li>
                              
                          </ul>
                      </div>
 
                    </div>
                  </div>
                </div>
                  </div>
                </div>
             
            </div><!-- /main -->
          </div>
        </div>
      </div>
      
  </body>

</html>

<script type="text/javascript">
  var list = [];
  var p_dict = [];
  //when customer changes
  $("#customer3").on('change',function(){
    i=0;
    list = [];
    $("#subgroupadd__div3").hide();
    $('#workgroup3 option:gt(0)').remove().end();
    if($("#customer3 :selected").text()!="Select Customer"){
      $.ajax({
        url:"/persongroupadmin/remove/subgroup/",
        type:"POST",
        dataType:"json",
        data:{
          customerid : this.value,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success : function(data) {
          data = JSON.parse(data);
          for (var i in data){
            $("#workgroup3").append($('<option>', {text:data[i].fields.workgroup,value:data[i].pk}));
          } 
        },
        error : function(xhr,errmsg,err) {
          alert(err);
        }
      });
      return false;
    }
  });
  $("#workgroup3").on('change',function(){
    i=0;
    list = [];
    $("#subgroupadd__div3").hide();
    if($("#workgroup3 :selected").text()!="Select Workgroup"){
      $.ajax({
        url:"/persongroupadmin/remove/subgroup/",
        type:"POST",
        dataType:"json",
        data:{
          workgroupid : this.value,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success : function(data) {
           p_dict = JSON.parse(data);
           console.log(data);
        $("#subgroup_table3 td").parent().remove();
        $("#subgroupadd__div3").show();
        for(var i=0;i<p_dict.length;i++){
          $("#subgroup_table3").last().append('<tr ><td><input type="checkbox" class="chk" name="checkbox[]" value="'+p_dict[i].pk+'"/></td><td><input readonly class="form-control" style="border: 0px;" type="text" name="'+p_dict[i].fields.subgroupname+'" value="'+p_dict[i].fields.subgroupname+'"/></td><td><input readonly class="form-control" style="border: 0px;"  type="text" name="'+p_dict[i].fields.description+'" value="'+p_dict[i].fields.description+'"/></td></tr>');
        }
        },
        error : function(xhr,errmsg,err) {
          alert(err);
        }
      });
      return false;
    }
  });
  $("#rw3").click(function(){
    allVals = [];
    $(".chk:checked").each(function() {
      allVals.push($(this).val());
    });
    $.ajax({
      url:"/persongroupadmin/remove/subgroup",
      type:"POST",
      dataType:"json",
      traditional: true,
      data:{
        checked_items : allVals,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success : function(data) {
        if(data){
          if (confirm("there are dependencies in \t"+data+"\tSubgroupmembers\nDo you want to continue")){
            $("#myform3").submit();  
          }
        }
        else{
          $("#myform3").submit();  
        }
      },
      error : function(xhr,errmsg,err) {
        //alert(err);
      }
    });
  });
</script>
