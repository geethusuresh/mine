{% load humanize %} {% load sec_filters %}
<!DOCTYPE html>
<html ng-app="security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="300">
    <title>Oneconsole | Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/static/asset/bootstrap-select.min.css">
     <link rel="stylesheet" type="text/css" href="/static/angular/angular-chart.min.css">
    {% include "components/css.html"%}
    <!-- date range picker -->
    <!-- <link href="/static/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" /> -->
    <style type="text/css">
    #rcorners2 {
        border-radius: 25px;
        border: 2px solid #8AC007;
        padding: 20px;
        width: 200px;
        height: 150px;
    }
    
    #recently_closed .dataTables_length,
    #cust_await .dataTables_length {
        margin-left: 28% !important;
        margin-top: -29px;
    }
    
    .custom-box p {
        font-size: 16px;
    }
    #chartdiv {
        width   : 100%;
        height  : 300px;
    }
    </style>
    <script type="text/javascript">
    // setInterval(function() {
    //     window.name.reload();
    //   }, 300000);

    function popup_secured() {
        window.open("http://208.85.152.102/security/attackmap/", "_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=0, left=0, width=1024, height=1000,name=no,menubar=no");
    }
    </script>
    <!--<script src="/static/customer/js/plugins/jquery/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="/static/customer/js/plugins/bootstrap/bootstrap.min.js" type="text/javascript"></script>-->
</head>
<!--  This body id is used to set the Data Table -->

<body class="fixed" style="font-size:13px" id="resolver_dashboard" ng-controller='dashboardGraph'>
    {% if "Customer_Dashboard" in request.session.logged_user_priv %} {% include "components/cust_header.html"%} {% else %} {% include "components/asset_header.html"%} {% endif %}
    <div class="wrapper">
        {% include "side_bar/customer.html"%}
        <div class="rightside">
            <div class="page-head" style="margin-top:10px">
                <h1 class="text-thin">Threat Management | <small>Events</small></h1>
                <ol class="breadcrumb">
                    <li>You are here:</li>
                    <li><a href="/">Home</a></li>
                    <li><a href="/dashboard/index/">Threat Management</a></li>
                    <li class="active">Events</li>
                </ol>
            </div>
            {% if messages %}
            <ul>
                {% for message in messages %} {% if message.tags == 'success' %}
                <div class="alert alert-success">{{ message|safe }}</div>
                {% else %}
                <div class="alert alert-danger">{{ message|safe }}</div>
                {% endif %} {% endfor %}
            </ul>
            {% endif %}
            <!-- {% if not hosts %}
                <div class="alert alert-success" >No HOSTS Added.Please add hosts</div>
              {% endif %} -->
                <!-- {% if not hosts %}
                <div id="floating-top-right" class="floating-container" style="margin-top:4%">
                    <div class="alert-wrap in animated jellyIn">
                        <div class="alert alert-purple" role="alert">
                            <button class="close" type="button">
                                <i class="fa fa-times-circle"></i>
                            </button>
                            <div class="media">
                                <div class="media-body">
                                    <h4 class="alert-title"></h4>
                                    <p class="alert-message"><strong>No HOSTS registered for monitoring</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %} -->
            <div class="content">
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="box">
                            <div class="box-body table-responsive no-padding">
                                <div class="row">
                                    <div class="col-md-11">
                                        <div id="pie_chart"></div>
                                    </div>
                                    <!-- <div class="col-md-1" style="display:none" id="date_filter1">
                                        <a href="#" id="drop_thought2" role="button" class="dropdown-toggle pull-right btn btn-info white-text" style="margin-right: 5px;" data-toggle="dropdown"><i class="fa fa-calendar"></i> </a>
                                        <ul class="dropdown-menu white-text" id="tools_drop2" role="menu" aria- labelledby="drop_thought">
                                            <li onclick="changePie1(1)"><a class="btn  white-text">Today</a></li>
                                            <li onclick="changePie1(2)"><a class="btn  white-text">Last Day</a></li>
                                            <li onclick="changePie1(3)"><a class="btn">Last Week</a></li>
                                        </ul>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="box">
                            <div class="box-body table-responsive no-padding">
                                <div class="row">
                                    <div class="col-md-11">
                                        <div id="pie_chart2"></div>
                                    </div>
                                    <!-- <div class="col-md-1" style="display:none" id="date_filter2">
                                        <a href="#" id="drop_thought2" role="button" class="dropdown-toggle pull-right btn btn-info white-text" style="margin-right: 5px;" data-toggle="dropdown"><i class="fa fa-calendar"></i> </a>
                                        <ul class="dropdown-menu white-text " id="tools_drop2" role="menu" aria-labelledby="drop_thought" style="left: auto;right: 100%;margin-left: 0;margin-right: -1px;">
                                            <li onclick="changePie2(1)"><a class="btn  white-text">Today</a></li>
                                            <li onclick="changePie2(2)"><a class="btn  white-text">Last Day</a></li>
                                            <li onclick="changePie2(3)"><a class="btn">Last Week</a></li>
                                        </ul>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6" >
                        <div class="box">
                            <div class="box-body table-responsive no-padding">
                                <div class="row">
                                    <div class="col-md-11">
                                        <div id="pie_chart3"></div>
                                    </div>
                                    <!-- <div class="col-md-1" style="display:none" id="date_filter2">
                                        <a href="#" id="drop_thought2" role="button" class="dropdown-toggle pull-right btn btn-info white-text" style="margin-right: 5px;" data-toggle="dropdown"><i class="fa fa-calendar"></i> </a>
                                        <ul class="dropdown-menu white-text " id="tools_drop2" role="menu" aria-labelledby="drop_thought" style="left: auto;right: 100%;margin-left: 0;margin-right: -1px;">
                                            <li onclick="changePie2(1)"><a class="btn  white-text">Today</a></li>
                                            <li onclick="changePie2(2)"><a class="btn  white-text">Last Day</a></li>
                                            <li onclick="changePie2(3)"><a class="btn">Last Week</a></li>
                                        </ul>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" >
                        <div class="panel">
                            <div class="panel-heading">
                                <p class="panel-title text-center"><strong>Top 5 Attackers </strong>(Last Week) </p>
                            </div>
                            <div class="panel-body table-responsive ">
                                <table class="table table-hover " id="location_table21">
                                    <thead>
                                        <tr>
                                            <th>Source IP</th>
                                            <th>Count</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in top_attackers %}
                                        <tr id="locate">
                                            <td>{{ item.0 }}</td>
                                            <td>{{ item.1 }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="cahrt_popup" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog" style="width:80%;">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: white!important;">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <div class="row">
                            <div class="col-md-3">
                                <h4>Events&nbsp <span id="date_span">(Last Week)</span> </h4>
                            </div>
                            <!-- <div class="col-md-2"> -->
                            <!-- <div class="btn-group col-md-2" style="margin-left: -61px;">
                                <a href="#" id="drop_thought" role="button" class="dropdown-toggle btn btn-info white-text" data-toggle="dropdown"><i class="fa fa-calendar"></i> </a>
                                <ul class="dropdown-menu white-text" id="tools_drop" role="menu" aria- labelledby="drop_thought">
                                    <li id="l_week0"><a class="btn  white-text">Today</a></li>
                                    <li id="l_week"><a class="btn  white-text">Last Day</a></li> -->
                                    <!-- <li class="divider"></li> -->
                                    <!-- <li id="t_month"><a class="btn">Last Week</a></li> -->
                                    <!-- <li class="divider"></li> -->
                                    <!-- <li id="l_month"><a class="btn">Last Month</a></li> -->
                                    <!-- <li><a class="btn btn-primary">Permanent</a></li> -->
                                <!-- </ul>
                            </div> -->
                            <!-- </div> -->
                            <!-- </button> -->
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="row" id="chart_change_div">
                            <div class="col-md-2 vcenter">
                                <div class="vertical">
                                    <div class="boxTile btn btn-info rcorners2" style="width:62%;background-color: ;" id="bar" onclick="changeChart('bar')">
                                        <div class="square">
                                            <i class="fa fa-area-chart"></i>
                                            <div>
                                                <span class="text">Bar Chart</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="chart_div" class="col-md-8"></div>
                            <div id="modal_events_div" class="col-md-9" style="display:none;">
                                <div class="box">
                                    <table class="table table-hover table-striped" style="table-layout: fixed;    word-wrap: break-word;" id="modal_events_table">
                                        <thead>
                                            <tr>
                                                <th>Server</th>
                                                <th>Event Record Time</th>
                                                <th>Event Data</th>
                                                <!-- <th>Insert time</th> -->
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="border:0px">
                        <!-- <button class="btn btn-info" style="float:right;display:none;" id="host_submit" onclick="fetch_data()" type="submit">Fetch Events</button> -->
                        </form>
                    </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        
        
        
    {% if "Customer_Dashboard" in request.session.logged_user_priv %}
      {% include "components/customer_footer.html"%}
      {% else %}
      {% include "components/footer.html" %}
      {% endif %}
      {% include "components/service_request.html" %}
      {% include "security_monitoring/guage_meter.html" %}
      {% include "security_monitoring/redcanary/tickets_pie.html" %}

        <!-- // <script src="/static/customer/js/custom.js" type="text/javascript"></script> -->
        <script src="/static/js/highcharts/highcharts.js"></script>
        <script src="/static/js/highcharts/no-data-to-display.js"></script>
        <script src="/static/js/highcharts/highcharts-more.js"></script>
        <script src="/static/js/highcharts/exporting.js"></script>
        <script src="/static/js/chart.min.js"></script>
        <script type="text/javascript" src="/static/angular/angular.min.js"></script>
        <script type="text/javascript" src="/static/angular/angular-resource.js"></script>
        <script type="text/javascript" src="/static/angular/angular-route.js"></script>
        <script type="text/javascript" src="/static/angular/angular-chart.js"></script>
        <script type="text/javascript" src="/static/angular/app.js"></script>
        <script type="text/javascript" src="/static/angular/controllers.js"></script>
        <script src="/static/js/bootstrap-datepicker.js" type="text/javascript"></script>
        <script type="text/javascript" src="/static/asset/bootstrap-select.min.js"></script>
        <!-- // <script src="/static/daterangepicker/daterangepicker.js" type="text/javascript"></script> -->

        <script type="text/javascript">
        $(document).ready(function() {
            $.ajax({
                url: "/security/draw/events/chart",
                type: "POST",
                dataType: "json",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data1) {
                    labels = data1[1]
                    values = data1[0]
                        // for (var key in data1){
                        //   labels.push(key);
                        //   values.push(data1[key]);
                        // }
                    var data = {
                        labels: labels,
                        datasets: [{
                            label: "My Second dataset",
                            fillColor: "rgba(151,187,205,0.2)",
                            strokeColor: "rgba(151,187,205,1)",
                            pointColor: "rgba(151,187,205,1)",
                            pointStrokeColor: "#fff",
                            pointHighlightFill: "#fff",
                            pointHighlightStroke: "rgba(151,187,205,1)",
                            data: values
                        }]
                    };
                    var event_chart = document.getElementById('buyers').getContext('2d');
                    new Chart(event_chart).Line(data);
                },
            });
            return false;
        });

        function pieChart1() {
            $('#pie_chart').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    style: {
                        font: 'bold 16px "Trebuchet MS", Verdana, sans-serif'
                    },
                    text: 'Alerts'
                },
                exporting: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} ',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        },
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Percentage',
                     data: [
                        {% for item in alerts %}
                             ['{{item.0}}',{{item.1}}],
                        {% endfor %}
                        ],
                    point: {
                        events: {
                            click: function() {
                                console.log(this.name);
                                view_map(this.name, 'alerts');
                            }
                        }
                    }

                }]
            });
        }

        function pieChart2(data_list, title) {
            $('#pie_chart2').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    style: {
                        font: 'bold 16px "Trebuchet MS", Verdana, sans-serif'
                    },
                    text: 'Events to Tickets'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                exporting: {
                    enabled: false
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                width: '130px',
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Browser share',
                    data: [
                            {% for item in tickets %}
                                 ['{{item.0}}',{{item.1}}],
                            {% endfor %}
                    ],
                    point: {
                        events: {
                            click: function() {
                                view_tickets(this.name, 'tickets')
                            }
                        }
                    }
                }]
            });
        }
        function pieChart3() {
            $('#pie_chart3').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    style: {
                        font: 'bold 16px "Trebuchet MS", Verdana, sans-serif'
                    },
                    text: 'Incidents by Priority'
                },
                exporting: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} ',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        },
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Percentage',
                     data: [
                        {% for item in internalpriority %}
                             ['{{item.internalpriority}}',{{item.count}}],
                        {% endfor %}
                        ],
                    point: {
                        events: {
                            click: function() {
                                view_tickets(this.name, 'incident')
                            }
                        }
                    }

                }]
            });
        }
        pieChart1();
        pieChart2();
        pieChart3();
        
        </script>
        <script type="text/javascript">
        $(document).ready(function() {
            // $('#name_table21').dataTable({
            // "bPaginate": false,
            // "bLengthChange": false,
            // "bFilter": false,
            // "bInfo": false,
            // "bAutoWidth": false,
            // "order": [[ 1, "desc" ]]
            // });
            $('#table_index').DataTable();
            $('#agents_table').DataTable({
                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "aaSorting": []
            });
            
        });
        
        </script>
        <script type="text/javascript">
        var name_ajax = '';
        var type_ajax = '';
        var agent_ajax = '';
        var host_ajax = '';
        var source_ajax = '';
        var date = 0;
        var piedate = 0;
        var piedate2 = 0;
        var cat = '';
        var classi = '';

        


        function view_map(name, type, from_call) {
            console.log('view map'+name)
            
            l1_ajax = name;
            name_ajax = name;
            type_ajax = type;
            source_ajax = '';
            agent_ajax = '';
            host_ajax = '';

            $.ajax({
                url: "/redcanary/security/viewmap",
                type: "POST",
                dataType: "json",
                data: {
                    filter_value: name_ajax,
                    chart_type: type_ajax,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    // var obj = $.parseJSON(data);
                    // draw_map(obj);
                    var key = [];
                    var value = [];
                    for (var prop in data) {
                        // alert(prop + " is " + data[prop]);
                        key.push(data[prop][1]);
                        value.push(data[prop][0]);
                    }
                    draw_map(key, value)
                    $("#cahrt_popup").modal('show');
                    $("#chart_div").show();
                    $("#modal_events_div").hide();

                },
                error: function(xhr, errmsg, err) {
                    // alert(err);
                }
            });
            return false;
        }

        function modalEventsTable(temp) {
            console.log('ssss'+temp)
            

            if ($("#modal_events_table").hasClass('initialized')) {
                $('#modal_events_table').dataTable().fnDestroy();
            } else {
                $("#modal_events_table").addClass('initialized')
            }
            $('#modal_events_table').dataTable({
                "bLengthChange": false,
                // "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "processing": true,
                "ajax": {
                    "processing": true,
                    "url": "/redcanary/popup/events",
                    "dataType": "json",
                    "type": "POST",
                    "data": {
                        filter_type: type_ajax,
                        filter_value: name_ajax,
                        date: temp,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    "dataSrc": ""
                },
                "columns": [{
                    "": "fields.0"
                }, {
                    "": "fields.1"
                }, {
                    "": "fields.2"
                }],
            });
            $("#chart_div").hide();
            $("#modal_events_div").show();
        }

        function fetch_data() {
            if ($("input[name=person1]:checked")) {
                var temp = $("input[name=person1]:checked");
                var $td = $(temp).closest('td').next('td');
                var $th = $td.closest('table').find('th').eq($td.index());
                var f_type = $th.html();
                var f_value = $td.html().replace(/\&gt;/g, ">");
                if (f_type == 'Source IP') {
                    source_ajax = f_value;
                    agent_ajax = '';
                    host_ajax = '';
                } else if (f_type == 'Agent') {
                    agent_ajax = f_value;
                    source_ajax = '';
                    host_ajax = '';
                } else if (f_type == 'Host') {
                    host_ajax = f_value;
                    agent_ajax = '';
                    source_ajax = '';
                }
                ext_list = []
                if (cat != '') {
                    ext_list.push('category')
                    ext_list.push(cat)
                } else if (classi != '') {
                    ext_list.push('classification')
                    ext_list.push(classi)
                }
                // if (f_type == 'Agent'){
                //   a_value = f_value.replace(/\&gt;/g,">")
                // }
                $.ajax({
                    url: "/security/dashboard/filter",
                    type: "POST",
                    dataType: "json",
                    data: {
                        filter_value: f_value,
                        filter_type: f_type,
                        date: date,
                        temp_list: ext_list,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(data) {
                        // var obj = $.parseJSON(data);
                        // draw_map(obj);
                        var key = [];
                        var value = [];
                        for (var prop in data) {
                            //   // alert(prop + " is " + data[prop]);
                            key.push(data[prop][1]);
                            value.push(data[prop][0]);
                        }
                        draw_map(key, value);
                        $("#chart_div").show();
                    },
                    error: function(xhr, errmsg, err) {
                        // alert(err);
                    }
                });
                return false;
                // alert($("input[name=person1]:checked").val());
            }
        }

        function tempf(dat) {
            $("#chart_div").hide();
            $("#modal_events_div").show();
        }
        var chart;

        function draw_map(key, value) {
            chart = new Highcharts.Chart({
                chart: {
                    type: 'column',
                    renderTo: 'chart_div',
                },
                title: {
                    text: ''
                },
                exporting: {
                    enabled: false
                },                
                xAxis: {
                    min: 0,
                    max: 5,
                    categories: key,
                    labels: {
                        rotation: -45
                    },
                },
                scrollbar: {
                    enabled: false,
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Count'
                    }
                },

                tooltip: {
                    formatter: function() {
                        return '' +
                            this.series.name + ': ' + this.y;
                    }
                },

                plotOptions: {
                    column: {
                        minPointLength: 4
                    },
                    series: {
                        borderWidth: 0,
                        dataLabels: {
                            enabled: true,
                            format: '{point.y}'
                        }
                    }
                },

                series: [{
                    allowPointSelect: true,
                    type: 'column',
                    color: '#FF0000',
                    name: 'Events',
                    data: value,
                    point: {
                        events: {
                            click: function() {
                                modalEventsTable(this.category);
                            }
                        }
                    }
                }]
            });
        }
        $("#fetch").click(function() {
            if ($("#from_date").val() && $("#to_date").val()) {
                $.ajax({
                    url: "/security/modal/viewmap",
                    type: "POST",
                    dataType: "json",
                    data: {
                        filter_value: name_ajax,
                        chart_type: type_ajax,
                        from_date: $("#from_date").val(),
                        to_date: $("#to_date").val(),
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(data) {
                        // var obj = $.parseJSON(data);
                        // draw_map(obj);
                        // var key=[];
                        // var value=[];
                        // for (var prop in data) {
                        //   // alert(prop + " is " + data[prop]);
                        //   key.push(prop);
                        //   value.push(data[prop]);
                        // }
                        // draw_map(key,value)


                    },
                    error: function(xhr, errmsg, err) {
                        // alert(err);
                    }
                });
                return false;
            }
        });

        function modalHostTable() {
            if ($("#modal_host_table").hasClass('initialized')) {
                $('#modal_host_table').dataTable().fnDestroy();
            } else {
                $("#modal_host_table").addClass('initialized')
            }
            $('#modal_host_table').dataTable({
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "processing": true,
                "ajax": {
                    "processing": true,
                    "url": "/popup/hosts",
                    "dataType": "json",
                    "type": "POST",
                    "data": {
                        // filter_type2:type_ajax,
                        // filter_value2:name,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    "dataSrc": ""
                },
                "columns": [
                    // { "": "fields.id",sClass: "hidden" },
                    {
                        "": "",
                        "bSortable": false,
                    }, {
                        "": "fields.server_name"
                    },
                    // { "": "fields.event_data" },
                    // { "": "fields.event_record_time" },
                ],
                "columnDefs": [{
                    "targets": 0,
                    "data": "fields.id",
                    "defaultContent": "<input type='radio' name='person1' value=" + "data" + ">"
                }]
            });
            $("#chart_div").hide();
            $("#modal_events_div").hide();
        }

        function modalAgentTable() {
            if ($("#modal_agent_table").hasClass('initialized')) {
                $('#modal_agent_table').dataTable().fnDestroy();
            } else {
                $("#modal_agent_table").addClass('initialized')
            }
            $('#modal_agent_table').dataTable({
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "processing": true,
                "ajax": {
                    "processing": true,
                    "url": "/popup/agents",
                    "dataType": "json",
                    "type": "POST",
                    "data": {
                        // filter_type2:type_ajax,
                        // filter_value2:name,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    "dataSrc": ""
                },
                "columns": [
                    // { "": "fields.id",sClass: "hidden" },
                    {
                        "": "",
                        "bSortable": false,
                    }, {
                        "": "fields.agent_name"
                    },
                    // { "": "fields.event_data" },
                    // { "": "fields.event_record_time" },
                ],
                "columnDefs": [{
                    "targets": 0,
                    "data": "fields.id",
                    "defaultContent": "<input type='radio' name='person1' value=" + "data" + ">"
                }]
            });
            $("#chart_div").hide();
            $("#modal_events_div").hide();
        }

        function modalSourceTable() {
            if ($("#modal_source_table").hasClass('initialized')) {
                $('#modal_source_table').dataTable().fnDestroy();
            } else {
                $("#modal_source_table").addClass('initialized')
            }
            $('#modal_source_table').dataTable({
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "processing": true,
                "ajax": {
                    "processing": true,
                    "url": "/popup/source",
                    "dataType": "json",
                    "type": "POST",
                    "data": {
                        // filter_type2:type_ajax,
                        // filter_value2:name,
                        date: date,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    "dataSrc": ""
                },
                "columns": [
                    // { "": "fields.id",sClass: "hidden" },
                    {
                        "": "",
                        "bSortable": false,
                    }, {
                        "": "fields.ip"
                    },
                    // { "": "fields.event_data" },
                    // { "": "fields.event_record_time" },
                ],
                "columnDefs": [{
                    "targets": 0,
                    "data": "fields.id",
                    "defaultContent": "<input type='radio' name='person1' value=" + "data" + ">"
                }]
            });
            $("#chart_div").hide();
            $("#modal_events_div").hide();
        }

        function filterBy(val) {
            if (val == 'hosts') {
                modalHostTable();
            } else if (val == 'agents') {
                modalAgentTable();
            } else if (val == 'source') {
                modalSourceTable();
            }
            // alert(val);
        }

        function changeChart(dat) {
            if (dat == 'bar') {
                chart.series[0].update({
                    type: "bar"
                });
                $("#chart_div").show();
                $("#modal_events_div").hide();
            } else if (dat == 'line') {
                chart.series[0].update({
                    type: "line"
                });
                $("#chart_div").show();
                $("#modal_events_div").hide();
            } else if (dat == 'area') {
                chart.series[0].update({
                    type: "area"
                });
                $("#chart_div").show();
                $("#modal_events_div").hide();
            } else if (dat == 'events') {
                $("#chart_div").hide();
                $("#modal_events_div").show();
            }
        }
        $("#l_week0").click(function() {
            date = 0;
            piedate = 0;
            piedate2 = 0;
            $("#date_span").html('(Last 24 Hrs)')
            view_map(name_ajax, type_ajax);
            $("#chart_div").show();
            $("#modal_events_div").hide();
        });
        $("#l_week").click(function() {
            date = 1;
            piedate = 1;
            piedate2 = 1;
            $("#date_span").html('(Last 48 Hrs)')
            view_map(name_ajax, type_ajax);
            $("#chart_div").show();
            $("#modal_events_div").hide();
        });
        $("#t_month").click(function() {
            date = 2;
            piedate = 2;
            piedate2 = 2;
            $("#date_span").html('(Last Week)')
            view_map(name_ajax, type_ajax);
            $("#chart_div").show();
            $("#modal_events_div").hide();
        });
        $("#l_month").click(function() {
            date = 3;
            piedate = 3;
            piedate2 = 3;
            $("#date_span").html('(Last Month)')
            view_map(name_ajax, type_ajax);
            $("#chart_div").show();
            $("#modal_events_div").hide();
        });
        //   $('#cahrt_popup').on('hidden.bs.modal', function () {
        //     $("#date_span").html('(Last Week)')
        //     // do somethingâ€¦
        // })
        </script>
        <script>
        $("#snd_dash_main").addClass("active");
        $("#sec_open").css('display', 'block');
        $("#security").addClass("active");
        $(".close").click(function() {
            $("div").remove('.alert-wrap');
        });
        </script>
</body>

</html>
