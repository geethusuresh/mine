{% load humanize %}
{% load zone %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oneconsole | Dashboard</title>
    {% include "components/css.html"%}
    <script src="/static/customer/js/plugins/jquery/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="/static/customer/js/plugins/jquery-ui/jquery-ui-1.10.4.min.js" type="text/javascript"></script>
    <script src="/static/customer/js/plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<!-- Bootstrap -->
    <script src="/static/customer/js/plugins/bootstrap/bootstrap.min.js" type="text/javascript"></script>
    <script src="/static/customer/js/plugins/gritter/jquery.gritter.min.js" type="text/javascript"></script>
    <!-- Highcharts -->
    <script src="/static/customer/js/custom.js" type="text/javascript"></script>
    <script src="/static/js/highcharts/highcharts.js"></script>
    <script src="/static/js/highcharts/highcharts-more.js"></script>
    <script src="/static/js/highcharts/exporting.js"></script>
    <script src="/static/js/highcharts/highcharts_theme_sand.js"></script>
    <style type="text/css">
      table.fixed { table-layout:fixed; word-break:break-all;}
      table.fixed td { overflow: hidden; } 
      .bs{
        background-color: transparent;
      }
    </style>
    <link rel="stylesheet" type="text/css" href="/static/asset/bootstrap-select.min.css">
    </head>
    <body class="fixed" style="font-size:13px">

        {% if "Managed_Service_Admin" in request.session.roles %}
            {% include "components/cust_header.html"%}
        {% else %}
            {% include "components/header.html"%}
        {% endif %}
        {% include "components/msg_div.html"%}
        <div class="wrapper">
            {% if "Managed_Service_Admin" in request.session.roles %}
                {% include "side_bar/customer.html"%}
            {% else %}
                {% include "side_bar/sidebar.html"%}
            {% endif %}
            <div class="rightside">
                <div class="page-head" style="margin-top:10px">
                    <h1 class="text-thin">Reports | <small>Catagory wise Report</small></h1>
                    <ol class="breadcrumb">
                       <li>You are here:</li>
                        <li><a href="/">Home</a></li>
                        <li class="active">Reports</li>
                    </ol>
                </div>
                <div class="content">
                    <div class="row">
                        <div class="col-sm-12">
                            {% if fetched_report == False %}
                                <div class="panel">
                                    <div class="panel-body">
                                        <form method='POST' action='/category_wise_report/' target="_blank" onsubmit="return submit_report()">
                                         <!--  -->
                                            {% csrf_token %}
                                            <div class="col-sm-12">
                                                <div class="col-sm-4">
                                                    <label>Customer</label>
                                                    <select name="cust" id="cust" class="form-control" required>
                                                        <option value="">--Select Customers--</option>
                                                        {% for customer in customers %}
                                                            <option value="{{ customer.id }}">{{ customer.customername }}</option>
                                                        {% endfor %}
                                                    </select><br/>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>Category</label>
                                                    <select name="cat" id="cate" multiple class="form-control" required>
                                                        <option value="">--Select Categories--</option>
                                                    </select><br/>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>Subcategory</label>
                                                    <select name="sub_cat" id="sub_cat" multiple class="form-control">
                                                        <option value="">--Select Subcategories--</option>
                                                    </select><br/>
                                                </div><br/>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="col-sm-4">
                                                    <label>Engineers</label>
                                                    <select name="engineers" id="engineer" class="form-control" multiple>
                                                        <option value="">--Select Engineer--</option>
                                                    </select><br/>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>Priority</label>
                                                    <select name="priority" class="form-control" multiple>
                                                        <option value="">--Select--</option>
                                                        {% for priority in priority_list %}
                                                            <option value="{{ priority }}">{{ priority }}</option>
                                                        {% endfor %}
                                                    </select><br/>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>Status</label>
                                                    <select id="status" name="status" multiple class="form-control">
                                                    </select><br/>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="col-sm-4">
                                                    <label>Ticket Created</label>
                                                    <select name="duration" id="duration_set" required class="form-control">
                                                        <option value="">--Select--</option>
                                                        <option value="on">On</option>
                                                        <option value="between">Between</option>
                                                        <option value="after">After</option>
                                                        <option value="before">Before</option>
                                                    </select>
                                                </div>
                                                <div class="col-sm-4">
                                                    <div class="duration_div_start">
                                                        <label>Start Date</label>
                                                        <input type="text" class="form-control" id="start_date" name="start_date" required/>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <div class="duration_div_end" style="display:none">
                                                        <label>End Date</label>
                                                        <input type="text" class="form-control" id="end_date" name="end_date" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 pad-all">
                                                <input type="submit" value="Fetch Report" class="btn btn-success" />
                                                <label style = "font-weight: bold;color:red;display:none;margin-left:27px;margin-top: 7px;" id="error_section"></label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            {% else %}
                                <div class="row">
                                    <div class="panel panel-primary" style="font-size: 14px;font-weight: bold;margin: 10px 15px;padding: 5px 5px 5px 14px;text-align:center;">
                                        {{report_heading}} <br />
                                        Total Tickets Created: {{total_tickets_count}}
                                    </div>               
                                </div>
                                <!-- tabular_report and  -->
                                {% if "Customer_Dashboard" not in request.session.logged_user_priv or "Managed_Service_Admin" in request.session.roles  %}
                                    <!--Export Row -->
                                    <div class="row">
                                        <div class="controls">
                                            <form action="/export_toexcel/" method="post" target="_blank">
                                                {% csrf_token %}
                                                <input type="submit" style="float:right;min-width:20%;margin-right:18px; margin-bottom: 10px;" class="btn btn-success" value="Export To Excel"/>
                                                <input type="hidden" name="export_type" id="export_type" value="category_report" />
                                                <input type="hidden" name="is_egate_included" value="{{is_egate_included}}"/>
                                            </form>
                                        </div>          
                                    </div>
                                    <!--End export row -->
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                   <h3 class="panel-title"> <i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Overall Response Time (%)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_resp_container"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_resp_container').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'
                                                            },
                                                            title: {
                                                                text: 'Overall Response Time'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Within SLA',
                                                                    'Crossed SLA'                        
                                                                ]
                                                            },
                                                            yAxis: {
                                                                min: 0,
                                                                max:100,
                                                                title: {
                                                                    text: 'Overall Response SLA %'
                                                                }
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y +' %';
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    pointPadding: 0.2,
                                                                    borderWidth: 0
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=overall&sla_type=response&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                    name:"Within SLA",
                                                                    color: '#008000',                            
                                                                    data: [{{overall_response_sla.perc_overall_within_sla}}]
                                                                },
                                                                {
                                                                    name:"Crossed SLA",
                                                                    color:'#FF0000',                            
                                                                    data: [0,{{overall_response_sla.perc_overall_crossed_sla}}]
                                                                }
                                                            ]
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                           <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Overall Resolution Time (%)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_reso_container"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_reso_container').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'                       
                                                            },
                                                            title: {
                                                                text: 'Overall Resolution Time'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Within SLA',
                                                                    'Crossed SLA'                       
                                                                ]
                                                            },
                                                            yAxis: {
                                                                min: 0,
                                                                max:100,
                                                                title: {
                                                                    text: 'Overall Resolution SLA %'
                                                                }
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y +' %';
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    pointPadding: 0.2,
                                                                    borderWidth: 0
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=overall&sla_type=resolution&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                    name:"Within SLA",
                                                                    color: '#008000',                            
                                                                    data: [{{overall_resolution_sla.perc_overall_within_sla}}]
                                                                },
                                                                {
                                                                    name:"Crossed SLA",
                                                                    color:'#FF0000',                            
                                                                    data: [0,{{overall_resolution_sla.perc_overall_crossed_sla}}]
                                                                }
                                                            ]
                                                        });
                                                    </script>
                                                </div>
                                            </div> 
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Overall Response Time (#)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_resp_sla_container"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_resp_sla_container').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'                        
                                                            },
                                                            title: {
                                                                text: 'Overall Response Time'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Within SLA',
                                                                    'Crossed SLA'                        
                                                                ]
                                                            },
                                                            yAxis: {
                                                                title: {
                                                                    text: 'Overall Response SLA #'
                                                                }
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y;
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    pointPadding: 0.2,
                                                                    borderWidth: 0
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=overall&sla_type=response&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                    name:"Within SLA",
                                                                    color: '#008000',                            
                                                                    data: [{{overall_response_sla.reso_sla_within_count}}]
                                                                },
                                                                {
                                                                    name:"Crossed SLA",
                                                                    color:'#FF0000',                            
                                                                    data: [0,{{overall_response_sla.reso_sla_crossed_count}}]
                                                                }
                                                            ]
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                           <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Overall Resolution Time (#)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_reso_sla_container"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_reso_sla_container').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'                          
                                                            },
                                                            title: {
                                                                text: 'Overall Resolution Time'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Within SLA',
                                                                    'Crossed SLA'                        
                                                                ]
                                                            },
                                                            yAxis: {
                                                                title: {
                                                                    text: 'Overall Resolution SLA #'
                                                                }
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y;
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    pointPadding: 0.2,
                                                                    borderWidth: 0
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=overall&sla_type=resolution&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                    name:"Within SLA",
                                                                    color: '#008000',                            
                                                                    data: [{{overall_resolution_sla.reso_sla_within_count}}]
                                                                },
                                                                {
                                                                    name:"Crossed SLA",
                                                                    color:'#FF0000',                            
                                                                    data: [0,{{overall_resolution_sla.reso_sla_crossed_count}}]
                                                                }
                                                            ]
                                                        });
                                                    </script>
                                                </div>
                                            </div> 
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Response Time - Priority Wise (%)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_resp_container_prioritywise"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_resp_container_prioritywise').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'                                     
                                                            },
                                                            title: {
                                                                text: 'Response Time - Priority wise'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Low',
                                                                    'Medium',
                                                                    'High',
                                                                    'Critical',
                                                                    'Urgent',
                                                                    'Normal',
                                                                    'Purchase',
                                                                    'Change'                                  
                                                                ],
                                                                labels: {
                                                                    rotation: -45
                                                                } 
                                                            },
                                                            yAxis: {
                                                                min: 0,
                                                                max:100,
                                                                title: {
                                                                    text: 'Response SLA %'
                                                                }
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y +' %';
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    minPointLength: 2
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            var category_detail = this.category.replace(/ /g, "_");
                                                                            str_name = str_name.replace(/ /g, "_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=priority_wise&priority="+category_detail+"&sla_type=response&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                type: 'column',
                                                                color:'#008000',
                                                                name: 'Within SLA',
                                                                data: [{{overall_response_sla.perc_overall_low_within_sla}}, {{overall_response_sla.perc_overall_medium_within_sla}}, {{overall_response_sla.perc_overall_high_within_sla}},
                                                                  {{overall_response_sla.perc_overall_critical_within_sla}},
                                                                  {{overall_response_sla.perc_overall_urgent_within_sla}},
                                                                  {{overall_response_sla.perc_overall_normal_within_sla}},
                                                                  {{overall_response_sla.perc_overall_purchase_within_sla}},
                                                                  {{overall_response_sla.perc_overall_change_within_sla}}]
                                                            }, {
                                                                type: 'column',
                                                                color:'#FF0000',
                                                                name: 'Crossed SLA',
                                                                data: [{{overall_response_sla.perc_overall_low_crossed_sla}}, {{overall_response_sla.perc_overall_medium_crossed_sla}}, {{overall_response_sla.perc_overall_high_crossed_sla}},
                                                                {{overall_response_sla.perc_overall_critical_crossed_sla}},
                                                                {{overall_response_sla.perc_overall_urgent_crossed_sla}},
                                                                {{overall_response_sla.perc_overall_normal_crossed_sla}},
                                                                {{overall_response_sla.perc_overall_purchase_crossed_sla}},
                                                                {{overall_response_sla.perc_overall_change_crossed_sla}}]
                                                            }]
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Resolution Time - Priority Wise (%)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_reso_container_prioritywise"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_reso_container_prioritywise').highcharts({
                                                                chart: {
                                                                    type: 'column',
                                                                    backgroundColor: 'white'                                    
                                                                },
                                                                title: {
                                                                    text: 'Resolution Time - Priority wise'
                                                                },                                
                                                                xAxis: {
                                                                    categories: [
                                                                        'Low',
                                                                        'Medium',
                                                                        'High',
                                                                        'Critical',
                                                                        'Urgent',
                                                                        'Normal',
                                                                        'Purchase',
                                                                        'Change'
                                                                    ],
                                                                    labels: {
                                                                      rotation: -45 
                                                                    } 
                                                                },
                                                                yAxis: {
                                                                    min: 0,
                                                                    max:100,
                                                                    title: {
                                                                        text: 'Resolution SLA %'
                                                                    }
                                                                },
                                                                tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y +' %';
                                                                  }
                                                                },
                                                                exporting: {
                                                                    enabled: false
                                                                },
                                                                plotOptions: {
                                                                    column: {                                          
                                                                        minPointLength: 2
                                                                    },
                                                                    series: {
                                                                        cursor: 'pointer',
                                                                        point: {
                                                                            events: {
                                                                                click: function (event) {
                                                                                var str_name = this.series.name;
                                                                                var category_detail = this.category.replace(/ /g, "_");
                                                                                str_name = str_name.replace(/ /g,"_");
                                                                                window.open("/ticket_popup/?report_type=category_wise&graph_section=priority_wise&priority="+category_detail+"&sla_type=resolution&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                },
                                                                series: [{
                                                                      type: 'column',
                                                                      color:'#008000',
                                                                      name: 'Within SLA',
                                                                      data: [{{overall_resolution_sla.perc_overall_low_within_sla}}, {{overall_resolution_sla.perc_overall_medium_within_sla}}, {{overall_resolution_sla.perc_overall_high_within_sla}},
                                                                      {{overall_resolution_sla.perc_overall_critical_within_sla}},
                                                                      {{overall_resolution_sla.perc_overall_urgent_within_sla}},
                                                                      {{overall_resolution_sla.perc_overall_normal_within_sla}},
                                                                      {{overall_resolution_sla.perc_overall_purchase_within_sla}},
                                                                      {{overall_resolution_sla.perc_overall_change_within_sla}}]
                                                                  }, {
                                                                      type: 'column',
                                                                      color:'#FF0000',
                                                                      name: 'Crossed SLA',
                                                                      data: [{{overall_resolution_sla.perc_overall_low_crossed_sla}}, {{overall_resolution_sla.perc_overall_medium_crossed_sla}}, {{overall_resolution_sla.perc_overall_high_crossed_sla}},
                                                                      {{overall_resolution_sla.perc_overall_critical_crossed_sla}},
                                                                      {{overall_resolution_sla.perc_overall_urgent_crossed_sla}},
                                                                      {{overall_resolution_sla.perc_overall_normal_crossed_sla}},
                                                                      {{overall_resolution_sla.perc_overall_purchase_crossed_sla}},
                                                                      {{overall_resolution_sla.perc_overall_change_crossed_sla}}]
                                                                }]
                                                            });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Response Time - Priority Wise (#)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="resp_priority_count_container"></div>
                                                    <script type="text/javascript">
                                                        $('#resp_priority_count_container').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'
                                                            },
                                                            title: {
                                                                text: 'Response Time - Priority wise'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Low',
                                                                    'Medium',
                                                                    'High',
                                                                    'Critical',
                                                                    'Urgent',
                                                                    'Normal',
                                                                    'Purchase',
                                                                    'Change'                             
                                                                ],
                                                                labels: {
                                                                    rotation: -45                           
                                                                } 
                                                            },
                                                            yAxis: {
                                                                title: {
                                                                    text: 'Response SLA #'
                                                                }
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y;
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    minPointLength: 2
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            var category_detail = this.category.replace(/ /g, "_");
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=priority_wise&priority="+category_detail+"&sla_type=response&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                type: 'column',
                                                                color:'#008000',
                                                                name: 'Within SLA',
                                                                data: [{{overall_response_sla.overall_low_within_sla}}, 
                                                                {{overall_response_sla.overall_medium_within_sla}}, 
                                                                {{overall_response_sla.overall_high_within_sla}},
                                                                  {{overall_response_sla.overall_critical_within_sla}},
                                                                  {{overall_response_sla.overall_urgent_within_sla}},
                                                                  {{overall_response_sla.overall_normal_within_sla}},
                                                                  {{overall_response_sla.overall_purchase_within_sla}},
                                                                  {{overall_response_sla.overall_change_within_sla}}]
                                                            }, {
                                                                type: 'column',
                                                                color:'#FF0000',
                                                                name: 'Crossed SLA',
                                                                data: [{{overall_response_sla.overall_low_crossed_sla}}, {{overall_response_sla.overall_medium_crossed_sla}}, 
                                                                {{overall_response_sla.overall_high_crossed_sla}},
                                                                {{overall_response_sla.overall_critical_crossed_sla}},
                                                                {{overall_response_sla.overall_urgent_crossed_sla}},
                                                                {{overall_response_sla.overall_normal_crossed_sla}},
                                                                {{overall_response_sla.overall_purchase_crossed_sla}},
                                                                {{overall_response_sla.overall_change_crossed_sla}}]
                                                            }]
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Resolution Time - Priority Wise (#)</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="reso_priority_count_container"></div>
                                                    <script type="text/javascript">
                                                        $('#reso_priority_count_container').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'
                                                            },
                                                            title: {
                                                                text: 'Resolution Time - Priority wise'
                                                            },                                
                                                            xAxis: {
                                                                categories: [
                                                                    'Low',
                                                                    'Medium',
                                                                    'High',
                                                                    'Critical',
                                                                    'Urgent',
                                                                    'Normal',
                                                                    'Purchase',
                                                                    'Change'                                  
                                                                ],
                                                                labels: {
                                                                  rotation: -45                                         
                                                                } 
                                                            },
                                                            yAxis: {
                                                                // min: 0,
                                                                // max:100,
                                                                title: {
                                                                    text: 'Resolution SLA #'
                                                                }
                                                            },
                                                            tooltip: {
                                                            formatter: function() {
                                                                return ''+
                                                                this.series.name +': '+ this.y;
                                                              }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {                                          
                                                                    minPointLength: 2
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            var category_detail = this.category.replace(/ /g, "_");
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=priority_wise&priority="+category_detail+"&sla_type=resolution&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                  type: 'column',
                                                                  color:'#008000',
                                                                  name: 'Within SLA',
                                                                  data: [{{overall_resolution_sla.overall_low_within_sla}}, {{overall_resolution_sla.overall_medium_within_sla}}, 
                                                                  {{overall_resolution_sla.overall_high_within_sla}},
                                                                  {{overall_resolution_sla.overall_critical_within_sla}},
                                                                  {{overall_resolution_sla.overall_urgent_within_sla}},
                                                                  {{overall_resolution_sla.overall_normal_within_sla}},
                                                                  {{overall_resolution_sla.overall_purchase_within_sla}},
                                                                  {{overall_resolution_sla.overall_change_within_sla}}]
                                                              }, {
                                                                  type: 'column',
                                                                  color:'#FF0000',
                                                                  name: 'Crossed SLA',
                                                                  data: [{{overall_resolution_sla.overall_low_crossed_sla}}, {{overall_resolution_sla.overall_medium_crossed_sla}}, 
                                                                  {{overall_resolution_sla.overall_high_crossed_sla}},
                                                                  {{overall_resolution_sla.overall_critical_crossed_sla}},
                                                                  {{overall_resolution_sla.overall_urgent_crossed_sla}},
                                                                  {{overall_resolution_sla.overall_normal_crossed_sla}},
                                                                  {{overall_resolution_sla.overall_purchase_crossed_sla}},
                                                                  {{overall_resolution_sla.overall_change_crossed_sla}}]
                                                            }]
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Response Time - Category wise</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_resp_container_catewise"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_resp_container_catewise').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'
                                                            },
                                                            title: {
                                                                text: 'Response Time - Category wise'
                                                            },                                
                                                            xAxis: {
                                                                categories:[{% for x_item in category_wise_resp_count %} "{{x_item.0}}", {% endfor %}],
                                                                labels: {
                                                                    rotation: -45
                                                                }
                                                            },
                                                            yAxis: {
                                                                min: 0,                                     
                                                                title: {
                                                                    text: 'No. of tickets'
                                                                },
                                                                allowDecimals: false
                                                            },
                                                            tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y;
                                                                }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                   minPointLength: 2
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            var category_detail = this.category.replace(/ /g, "_");
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=response_wise&category="+category_detail+"&sla_type=response&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                type: 'column',
                                                                color:'#008000',
                                                                name: 'Within SLA',
                                                                data: [{% for sla_item in category_wise_resp_count %} {{sla_item.1}}, {% endfor %}]
                                                            },{
                                                                type: 'column',
                                                                color:'#FF0000',
                                                                name: 'Crossed SLA',
                                                                data: [{% for sla_item in category_wise_resp_count %} {{sla_item.2}}, {% endfor %}]
                                                            }]
                                                        });
                                                    </script>
                                                </div>                           
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Resolution Time - Category wise</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="overall_reso_container_catewise"></div>
                                                    <script type="text/javascript">
                                                        $('#overall_reso_container_catewise').highcharts({
                                                            chart: {
                                                                type: 'column',
                                                                backgroundColor: 'white'
                                                            },
                                                            title: {
                                                                text: 'Resolution Time - Category wise'
                                                            },                                
                                                            xAxis: {
                                                                categories:[{% for x_item in category_wise_reso_count %} "{{x_item.0}}", {% endfor %}],
                                                                labels: {
                                                                  rotation: -45
                                                                }
                                                            },
                                                            yAxis: {
                                                                min: 0,                                     
                                                                title: {
                                                                    text: 'No. of tickets'
                                                                },
                                                                allowDecimals: false
                                                            },
                                                            tooltip: {
                                                            formatter: function() {
                                                                return ''+
                                                                this.series.name +': '+ this.y;
                                                              }
                                                            },
                                                            exporting: {
                                                                enabled: false
                                                            },
                                                            plotOptions: {
                                                                column: {
                                                                    minPointLength: 2
                                                                },
                                                                series: {
                                                                    cursor: 'pointer',
                                                                    point: {
                                                                        events: {
                                                                            click: function (event) {
                                                                            var str_name = this.series.name;
                                                                            var category_detail = this.category.replace(/ /g, "_");
                                                                            str_name = str_name.replace(/ /g,"_");
                                                                            window.open("/ticket_popup/?report_type=category_wise&graph_section=resolution_wise&category="+category_detail+"&sla_type=resolution&sla_status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            },
                                                            series: [{
                                                                  type: 'column',
                                                                  color:'#008000',
                                                                  name: 'Within SLA',
                                                                  data: [{% for sla_item in category_wise_reso_count %} {{sla_item.1}}, {% endfor %}]
                                                              },{
                                                                  type: 'column',
                                                                  color:'#FF0000',
                                                                  name: 'Crossed SLA',
                                                                  data: [{% for sla_item in category_wise_reso_count %} {{sla_item.2}}, {% endfor %}]
                                                              }]
                                                        });
                                                    </script>
                                                </div>                           
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>
                                                    Category wise status details</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div id="cat_wise_status_details"></div>
                                                    <script type="text/javascript">
                                                        $('#cat_wise_status_details').highcharts({
                                                                chart: {
                                                                    type: 'column',
                                                                    backgroundColor: 'white'
                                                                },
                                                                title: {
                                                                    text: 'Category wise status details'
                                                                },                                
                                                                xAxis: {
                                                                    categories:[{% for key,value in status_wise_report.0.items %} {% for key1, value1 in value.items %}
                                                                      {% if key1 != "colors" %}
                                                                     "{{key1}}", {% endif %} {% endfor %} {% endfor %}],
                                                                     labels: {
                                                                      rotation: -45                                         
                                                                    }                                              
                                                                },
                                                                yAxis: {
                                                                    min: 0,                                     
                                                                    title: {
                                                                        text: 'No. of tickets'
                                                                    },
                                                                    allowDecimals: false
                                                                },

                                                                tooltip: {
                                                                formatter: function() {
                                                                    return ''+
                                                                    this.series.name +': '+ this.y;
                                                                  }
                                                                },                                 
                                                                exporting: {
                                                                    enabled: false
                                                                },
                                                                plotOptions: {
                                                                    column: {
                                                                        minPointLength: 2
                                                                    },
                                                                    series: {
                                                                        cursor: 'pointer',
                                                                        point: {
                                                                            events: {
                                                                                click: function (event) {
                                                                                    var str_name = this.series.name;
                                                                                    var category_detail = this.category.replace(/ /g, "_");
                                                                                    str_name = str_name.replace(/ /g,"_");
                                                                                    console.log(str_name, category_detail)
                                                                                    window.open("/ticket_popup/?report_type=category_wise&graph_section=status_wise&category="+category_detail+"&status="+str_name,"_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                },

                                                                series: [
                                                                    {% for status_details in status_wise_report %}
                                                                        {% for key, value in status_details.items %}
                                                                            {% if key != "colors" %}
                                                                                {
                                                                                      type: 'column',
                                                                                      name: '{{ key | real }}',
                                                                                
                                                                                      data: [{% for key_item, value_item in value.items %}
                                                                                      {% if key_item != "colors" %} {{value_item}},  {% endif %} {% endfor %}]
                                                                                },
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    {% endfor %}
                                                                ]
                                                            });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <h4 class="panel-title">Ticket Details</h4>
                                                </div>
                                                <div class="panel-body">
                                                    <table class="table table-striped table-bordered" id="report_table">
                                                        <thead>
                                                            <tr>
                                                                <th>Ticket No</th>
                                                                <th>Title</th>
                                                                <th>Created Date</th>
                                                                <th>Engineer</th>
                                                                <th>Affected Email</th>
                                                                <th>Ticket Priority</th>
                                                                <th>Ticket Type</th>
                                                                <th>Category</th>
                                                                <th>Subcategory</th>
                                                                <th>Case Status</th>
                                                                <th>Ticket Age</th>                
                                                                <th>First Response Time</th>
                                                                <th>Resolved Time</th>
                                                                <th>Response Duration</th>
                                                                <th>Resolved Duration</th>
                                                                <th>Last Updated</th>
                                                                <th>Work Hours (in minutes) </th>
                                                                {% if is_egate_included == True %}
                                                                    <th>Carrier</th>
                                                                {% endif %}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for ticket in tabular_report %}
                                                                <tr>
                                                                    <td>
                                                                        {% if ticket.priority_flag == True %}
                                                                            <a href="/ticket/{{ticket.ticket_id}}" target="_blank" class="btn btn-sm btn-danger" data-toggle="tooltip" data-placement="bottom" title="Important">{{ticket.ticket_number}}</a>
                                                                        {% else %}
                                                                            <a href="/ticket/{{ticket.ticket_id}}" target="_blank" class="btn btn-sm btn-success">{{ticket.ticket_number}}</a>
                                                                        {% endif %}
                                                                    </td>
                                                                    <td>{{ticket.title}}</td>
                                                                    <td><span style="display:none;">{{ticket.created_date.year}} {% if ticket.created_date.month >= 10 %}{{ticket.created_date.month}}{% else %}0{{ticket.created_date.month}}{%endif%}{% if ticket.created_date.day >= 10 %}{{ticket.created_date.day}}{% else %}0{{ticket.created_date.day}}{%endif%} {{ticket.created_date.time | time}}</span>{% tzone ticket.created_date %}</td>
                                                                    <td>{{ticket.engineer}}</td>
                                                                    <td>{{ticket.affected_email}}</td>
                                                                    <td>{{ticket.internal_priority}}</td>
                                                                    <td>
                                                                        {% if ticket.ticket_type == "SR"  %}
                                                                            Service Request
                                                                        {% elif ticket.ticket_type == "IN" %}
                                                                            Incident
                                                                        {% elif ticket.ticket_type == "PB" %}
                                                                            Problem
                                                                        {% elif ticket.ticket_type == "CH" %}
                                                                            Change
                                                                        {% else %}
                                                                            {{ ticket.ticket_type }}
                                                                        {% endif %}
                                                                    </td>            
                                                                    <td>{{ ticket.category }}</td>
                                                                    <td>{{ ticket.subcategory }}</td>
                                                                    <td>{{ticket.status | real:ticket.customer_id}}</td>
                                                                    <td>{{ticket.ticket_id|ticket_age}}</td>
                                                                    <td><span style="display:none;">{{ticket.first_response.year}}{% if ticket.first_response.month >= 10 %}{{ticket.first_response.month}}{% else %}0{{ticket.first_response.month}}{%endif%}{% if ticket.first_response.day >= 10 %}{{ticket.first_response.day}}{% else %}0{{ticket.first_response.day}}{%endif%} {{ticket.first_response.time | time}}</span>{% tzone ticket.first_response %}</td>
                                                                    <td><span style="display:none;">{{ticket.resolved_time.year}}{% if ticket.resolved_time.month >= 10 %}{{ticket.resolved_time.month}}{% else %}0{{ticket.resolved_time.month}}{%endif%}{% if ticket.resolved_time.day >= 10 %}{{ticket.resolved_time.day}}{% else %}0{{ticket.resolved_time.day}}{%endif%} {{ticket.resolved_time.time | time}}</span>{% tzone ticket.resolved_time %}</td>
                                                                    <td style="background-color:{{ticket.response_color}}">{{ticket.duration_response}}</td>
                                                                    <td style="background-color:{{ticket.resolution_color}};">{{ticket.duration_resolution}}</td>
                                                                    <td><span style="display:none;">{{ticket.changedate.year}}{% if ticket.changedate.month >= 10 %}{{ticket.changedate.month}}{% else %}0{{ticket.changedate.month}}{%endif%}{% if ticket.changedate.day >= 10 %}{{ticket.changedate.day}}{% else %}0{{ticket.changedate.day}}{%endif%}{{ticket.changedate.time | time}}</span>
                                                                    {% tzone ticket.changedate %}
                                                                    </td>
                                                                    <td>{{ ticket.ticket_id | work_hour}}</td>
                                                                    {% if is_egate_included == True %}
                                                                        <td>{{ ticket.carrier }}</td>
                                                                    {% endif %}
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>                         
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% include "components/dashboard_footer.html"%}
        {% if "Customer_Dashboard" in request.session.logged_user_priv %}
            {% include "components/sr_cust.html"%}
        {% else %}
            {% include "components/service_request.html"%}
        {% endif %}
        <script type="text/javascript">
            $(function() {
              $( "#start_date" ).datepicker({ dateFormat: "mm-dd-yy" });
              $( "#end_date" ).datepicker({ dateFormat: "mm-dd-yy" });
            });
            $('#cust').on('change', function(){
                $('#cate option:gt(0)').remove().end();
                $('#sub_cat option:gt(0)').remove().end();
                $('#engineer option:gt(0)').remove().end();
                var customers = $('#cust').val();
                $('#status option').remove().end();
                if (this.value) {
                    $.ajax({
                        url: "/category_wise_report/?categories=true",
                        type:"GET",
                        data: {
                            'customers': customers.toString(),
                        },
                        success: function(data){
                            var categories = data['categories'];
                            for (var i in categories) {
                                $('#cate').append($('<option>',
                                    {
                                        value: categories[i][0],
                                        text: categories[i][1]
                                    }
                                ))
                            }
                            var engineers = data['engineers'];
                            for (var i in engineers) {
                                $('#engineer').append($('<option>', {
                                    value: engineers[i][0],
                                    text: engineers[i][1]
                                }))
                            }
                        }
                    })
                    $.ajax({
                        url: "/reports/?data_list=true&customer="+this.value,
                        type: "GET",
                        success: function(data) {
                            var status_list = data['status_list'];
                            for (var i in status_list) {
                                $('#status').append($('<option>', {
                                    value: status_list[i].status,
                                    text: status_list[i].display_status
                                }));
                            }
                        }
                    });
                }
            });
            $('#cate').on('change', function(){
                $('#sub_cat option:gt(0)').remove().end();
                var cat_val = $('#cate').val();
                $.ajax({
                    url: "/category_wise_report/?subcategories=true",
                    data: {
                        'categories': cat_val.toString(),
                    },
                    type: "GET",
                    success: function(data) {
                        for (var i in data){
                            $("#sub_cat").append($('<option>', 
                                { 
                                    value:data[i][0],
                                    text:data[i][1]
                                }
                            ))
                        }
                    }
                })
            });
            $('#duration_set').on('click', function() {
                var duration_choosed = $('#duration').val();
                if ($('#duration_set').val() == "between") {
                    $('.duration_div_end').show();
                } else {
                    $('.duration_div_end').hide();
                }
            });
            $(document).ready(function(){
                $('.duration_div_end').hide();
            })
            function submit_report(){
                if($('#duration_set').val() == "between"){
                    if ($('#start_date').val() != "" && $('#end_date').val() != ''){
                        var start = $('#start_date').val().replace(/-/g, '/');
                        var end = $('#end_date').val().replace(/-/g, '/');
                        val_1 = new Date(start);
                        val_2 = new Date(end);
                        var diff = val_2 - val_1;
                        if (diff < 0) {
                            $('#error_section').show();
                            $( "#error_section" ).text( "Please choose valid start and end date !" ).show();
                            return false;
                        } else {
                            $('#error_section').hide();
                            return true;
                        }
                    } else {
                        $('#error_section').show();
                        $( "#error_section" ).text( "Please choose start and end date !" ).show();
                        return false;
                    }
                } else if ($('#start_date').val() == "") {
                    $('#error_section').show();
                    $( "#error_section" ).text( "Please choose start date !" ).show();
                    return false;
                } else {
                    $('#error_section').hide();
                    return true;
                } 
            }
        </script>
        <script type="text/javascript">
            $(document).ready(function(){
                $('#report_table').dataTable({
                    aaSorting: [[2, 'desc']],
                    "bPaginate": false,
                    "bFilter": false,
                    "scrollX": true
                });
            })
        </script>
        <script src="/static/customer/js/custom.js" type="text/javascript"></script>
  </body>
</html>